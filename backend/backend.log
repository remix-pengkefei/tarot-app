
> tarot-backend@1.0.0 dev
> tsx watch src/index.ts

Using OpenAI service
Server is running on port 3001
OpenAI Assistant API error: OpenAIError: Path parameters result in path with invalid segments:
Value of type Undefined is not a valid path parameter
/threads/undefined/runs/thread_GbcN0YNOG4WaOfS0zJPMbSQX
         ^^^^^^^^^
    at path (/Users/remix.fly/Desktop/tarot/backend/node_modules/openai/src/internal/utils/path.ts:75:13)
    at Runs.retrieve (/Users/remix.fly/Desktop/tarot/backend/node_modules/openai/src/resources/beta/threads/runs/runs.ts:88:33)
    at Object.analyzeQuestion (/Users/remix.fly/Desktop/tarot/backend/src/services/openai.service.ts:60:52)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Object.analyzeQuestionAndRecommendSpread (/Users/remix.fly/Desktop/tarot/backend/src/services/divination.service.ts:28:22)
    at async <anonymous> (/Users/remix.fly/Desktop/tarot/backend/src/routes/divination.routes.ts:16:20)
OpenAI Assistant API error (interpretCard): OpenAIError: Path parameters result in path with invalid segments:
Value of type Undefined is not a valid path parameter
/threads/undefined/runs/thread_bQAgP1WaNO3QUNB72qb8uuen
         ^^^^^^^^^
    at path (/Users/remix.fly/Desktop/tarot/backend/node_modules/openai/src/internal/utils/path.ts:75:13)
    at Runs.retrieve (/Users/remix.fly/Desktop/tarot/backend/node_modules/openai/src/resources/beta/threads/runs/runs.ts:88:33)
    at Object.interpretCard (/Users/remix.fly/Desktop/tarot/backend/src/services/openai.service.ts:119:52)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async <anonymous> (/Users/remix.fly/Desktop/tarot/backend/src/services/divination.service.ts:76:32)
    at async Promise.all (index 0)
    at async Object.drawAndInterpretCards (/Users/remix.fly/Desktop/tarot/backend/src/services/divination.service.ts:65:29)
    at async <anonymous> (/Users/remix.fly/Desktop/tarot/backend/src/routes/divination.routes.ts:36:20)
16:17:35 [tsx] change in ./src/services/openai.service.ts Restarting...
c16:17:36 [tsx] change in ./src/services/openai.service.ts Restarting...
cUsing OpenAI service
Server is running on port 3001
16:17:52 [tsx] change in ./src/services/openai.service.ts Restarting...
cUsing OpenAI service
Server is running on port 3001
16:17:55 [tsx] change in ./src/services/openai.service.ts Restarting...
c16:17:55 [tsx] change in ./src/services/openai.service.ts Restarting...
cUsing OpenAI service
Server is running on port 3001
16:17:59 [tsx] change in ./src/services/openai.service.ts Restarting...
c16:17:59 [tsx] change in ./src/services/openai.service.ts Restarting...
c16:17:59 [tsx] change in ./src/services/openai.service.ts Restarting...
c16:17:59 [tsx] change in ./src/services/openai.service.ts Restarting...
c16:17:59 [tsx] change in ./src/services/openai.service.ts Restarting...
Using OpenAI service
Server is running on port 3001
cUsing OpenAI service
Server is running on port 3001
16:18:05 [tsx] change in ./src/services/openai.service.ts Restarting...
cUsing OpenAI service
Server is running on port 3001
16:37:10 [tsx] change in ./src/services/openai.service.ts Restarting...
cUsing OpenAI service
Server is running on port 3001
Unexpected error: PrismaClientValidationError: 
Invalid `prisma.divination.create()` invocation in
/Users/remix.fly/Desktop/tarot/backend/src/services/divination.service.ts:31:48

  28 const analysis = await aiService.analyzeQuestion(question, spreads);
  29 
  30 // Create divination record
â†’ 31 const divination = await prisma.divination.create({
       data: {
         question: "æˆ‘ä¸‹åˆåº”è¯¥å»æ¸¸æ³³å—ï¼Ÿ",
         spreadId: "å•å¼ ç‰Œé˜µ",
                   ~~~~~~
         questionAnalysis: "ä½ æ­£åœ¨è€ƒè™‘ä¸€ä¸ªç®€å•çš„å†³ç­–ï¼Œå³æ˜¯å¦åœ¨ä¸‹åˆå»æ¸¸æ³³ã€‚è¿™æ˜¯ä¸€ä¸ªå…³äºå¦‚ä½•åº¦è¿‡ä½ ä¸€å¤©çš„å°é€‰æ‹©ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¤æ‚æˆ–æ·±è¿œçš„äººç”Ÿé—®é¢˜ã€‚",
         spreadRecommendation: "å•å¼ ç‰Œé˜µé€‚åˆæä¾›å¿«é€Ÿçš„æŒ‡å¼•å’Œç®€å•çš„å†³ç­–ã€‚è¿™ç§ç‰Œé˜µå¯ä»¥ç»™ä½ ä¸€ä¸ªç›´æ¥çš„ç­”æ¡ˆæˆ–æŒ‡å¼•ï¼Œå¸®åŠ©ä½ å†³å®šæ˜¯å¦åœ¨ä¸‹åˆå»æ¸¸æ³³ã€‚"
       },
       include: {
         spread: true
       }
     })

Argument `spreadId`: Invalid value provided. Expected Int, provided String.
    at wn (/Users/remix.fly/Desktop/tarot/backend/node_modules/@prisma/client/runtime/library.js:29:1363)
    at $n.handleRequestError (/Users/remix.fly/Desktop/tarot/backend/node_modules/@prisma/client/runtime/library.js:121:6958)
    at $n.handleAndLogRequestError (/Users/remix.fly/Desktop/tarot/backend/node_modules/@prisma/client/runtime/library.js:121:6623)
    at $n.request (/Users/remix.fly/Desktop/tarot/backend/node_modules/@prisma/client/runtime/library.js:121:6307)
    at async l (/Users/remix.fly/Desktop/tarot/backend/node_modules/@prisma/client/runtime/library.js:130:9633)
    at async Object.analyzeQuestionAndRecommendSpread (/Users/remix.fly/Desktop/tarot/backend/src/services/divination.service.ts:31:24)
    at async <anonymous> (/Users/remix.fly/Desktop/tarot/backend/src/routes/divination.routes.ts:16:20) {
  clientVersion: '5.22.0'
}
16:39:16 [tsx] change in ./src/services/openai.service.ts Restarting...
c16:39:16 [tsx] change in ./src/services/openai.service.ts Restarting...
Using OpenAI service
Server is running on port 3001
cUsing OpenAI service
Server is running on port 3001
16:39:21 [tsx] change in ./src/services/openai.service.ts Restarting...
cUsing OpenAI service
Server is running on port 3001
16:39:21 [tsx] change in ./src/services/openai.service.ts Restarting...
c16:39:21 [tsx] change in ./src/services/openai.service.ts Restarting...
cUsing OpenAI service
Server is running on port 3001
